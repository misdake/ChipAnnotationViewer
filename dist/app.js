!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var i=function(t,e,n,i){this.left=t,this.top=e,this.width=n,this.height=i},o=function(){function t(t,e,n){this.canvas=t,this.canvasElement=e,this.context=n}return t.prototype.clear=function(){this.context.fillStyle="#000000",this.context.fillRect(0,0,this.canvasElement.width,this.canvasElement.height)},t.prototype.setColor=function(t){this.context.fillStyle=t,this.context.strokeStyle=t},t.prototype.setFillColor=function(t){this.context.fillStyle=t},t.prototype.setStrokeColor=function(t){this.context.strokeStyle=t},t.prototype.calculateLineWidth=function(t,e){return e?e.onScreen+t.canvasSizeToScreen(e.onCanvas)+e.ofScreen*Math.min(this.canvasElement.width,this.canvasElement.height):1},t.prototype.renderPolyline=function(t,e,n,i,o,r){if(0!=e.length){this.context.lineWidth=this.calculateLineWidth(t,r),this.context.beginPath(),this.context.lineCap="round",this.context.lineJoin="round";var s=t.canvasToScreen(e[0].x,e[0].y);this.context.moveTo(s.x,s.y);for(var a=1;a<e.length;a++){var l=t.canvasToScreen(e[a].x,e[a].y);this.context.lineTo(l.x,l.y)}n&&this.context.closePath(),i&&this.context.fill(),o&&this.context.stroke()}},t.prototype.testImageVisibility=function(t,e,n,o,r,s){var a=t.canvasToScreen(n.position.x,n.position.y),l=t.canvasSizeToScreen(o),c=t.canvasSizeToScreen(r);return a.x-s>this.canvas.getWidth()||a.y-s>this.canvas.getHeight()?null:a.x+l+s<0||a.y+c+s<0?null:new i(a.x,a.y,l,c)},t.prototype.renderImage=function(t,e,n,i,o){var r=this.testImageVisibility(t,e,n,i,o,0);this.drawImage(e,r)},t.prototype.drawImage=function(t,e){e&&this.context.drawImage(t,e.left,e.top,e.width,e.height)},t.prototype.renderCircle=function(t,e,n,i,o,r,s){var a=t.canvasToScreen(e,n),l=t.canvasSizeToScreen(i);this.drawCircle(a.x,a.y,l,o,r),this.context.lineWidth=this.calculateLineWidth(t,s)},t.prototype.drawCircle=function(t,e,n,i,o,r){r&&(this.context.lineWidth=r),this.context.beginPath(),this.context.arc(t,e,n,0,2*Math.PI),this.context.closePath(),i&&this.context.fill(),o&&this.context.stroke()},t.prototype.drawRect=function(t,e,n,i,o,r,s){s&&(this.context.lineWidth=s),this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(t,i),this.context.lineTo(n,i),this.context.lineTo(n,e),this.context.closePath(),o&&this.context.fill(),r&&this.context.stroke()},t.prototype.measureText=function(t,e,n){var i=this.calculateLineWidth(t,n);return this.context.font=i+"px Arial",[this.context.measureText(e).width,i]},t.prototype.renderText=function(t,e,n,i,o,r,s){var a=t.canvasToScreen(i,o);this.drawText(e,n,a.x,a.y,r,s)},t.prototype.drawText=function(t,e,n,i,o,r){this.context.textAlign=o,this.context.textBaseline=r,this.context.font=e+"px Arial",this.context.fillText(t,n,i)},t}(),r=function(){this.position=new s(0,0)},s=function(t,e){this.x=t,this.y=e},a=function(){function t(){this.position=new s(0,0)}return t.prototype.load=function(t,e){this.canvas=t,this.zoomMin=0,this.zoomMax=e.maxLevel,this.zoom=e.maxLevel,this.checkZoom(),this.position.x=e.width/2,this.position.y=e.height/2,this.xMin=0,this.xMax=e.width,this.yMin=0,this.yMax=e.height},t.prototype.moveXy=function(t,e){this.position.x+=t,this.position.y+=e,this.checkXy()},t.prototype.checkXy=function(){this.position.x=Math.min(Math.max(this.position.x,this.xMin),this.xMax),this.position.y=Math.min(Math.max(this.position.y,this.yMin),this.yMax)},t.prototype.getZoom=function(){return this.zoom},t.prototype.changeZoomBy=function(t){this.zoom+=t,this.checkZoom()},t.prototype.setZoomTo=function(t){this.zoom=t,this.checkZoom()},t.prototype.checkZoom=function(){this.zoom=Math.min(Math.max(this.zoom,this.zoomMin),this.zoomMax)},t.prototype.action=function(){if(this.canvas){this.checkXy(),this.checkZoom();var t=1/(1<<this.zoom);this.scale=t,this.tx=this.canvas.getWidth()/2-this.position.x*t,this.ty=this.canvas.getHeight()/2-this.position.y*t}},t.prototype.screenXyToCanvas=function(t,e){var n=(t-this.tx)/this.scale,i=(e-this.ty)/this.scale;return new s(n,i)},t.prototype.canvasToScreen=function(t,e){var n=t*this.scale+this.tx,i=e*this.scale+this.ty;return new s(n,i)},t.prototype.screenSizeToCanvas=function(t){return t/this.scale},t.prototype.canvasSizeToScreen=function(t){return t*this.scale},t.prototype.canvasAABBInScreen=function(t){var e=t.x1*this.scale+this.tx,n=t.y1*this.scale+this.ty,i=t.x2*this.scale+this.tx,o=t.y2*this.scale+this.ty,r=this.canvas.getWidth(),s=this.canvas.getHeight();return!(i<0||e>r||o<0||n>s)},t}(),l=function(){},c=function(){function t(t,e,n,i){this.name=t,this.r=e,this.g=n,this.b=i}return t.findByName=function(t){for(var e=0,n=this.list;e<n.length;e++){var i=n[e];if(t==i.name)return i}return this.list[0]},t.list=[new t("red",255,0,0),new t("green",0,255,0),new t("blue",0,0,255),new t("cyan",0,255,255),new t("purple",255,0,255),new t("yellow",255,255,0),new t("gray",127,127,127),new t("white",255,255,255)],t}(),u=function(){function t(t,e,n){this.name=t,this.buttonColor=e,this.value=n}return t.findByName=function(t){for(var e=0,n=this.list;e<n.length;e++){var i=n[e];if(t==i.name)return i}return this.list[0]},t.findByValue=function(t){for(var e=0,n=this.list;e<n.length;e++){var i=n[e];if(t==i.value)return i}return this.list[0]},t.list=[new t("15","rgb(217,217,217)",.15),new t("25","rgb(191,191,191)",.25),new t("50","rgb(127,127,127)",.5),new t("75","rgb(63,63,63)",.75),new t("100","rgb(0,0,0)",1)],t}();function h(t,e){return"rgba("+t.r+","+t.g+","+t.b+","+e.value+")"}var p,f=function(){function t(){}return t.prototype.onkeydown=function(t){return!1},t.prototype.onkeyup=function(t){return!1},t.prototype.onkeypress=function(t){return!1},t}(),d=(p=function(t,e){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),y=function(){function t(){}return t.isMobile=function(){return/Mobi|Android/i.test(navigator.userAgent)},t.createPolylineKeyboardListener=function(e,n,i,o){return new(function(r){function s(){return null!==r&&r.apply(this,arguments)||this}return d(s,r),s.prototype.onkeydown=function(r){var s=n.screenSizeToCanvas(1),a=t.getMove(r,s),l=a.dx,c=a.dy;return 0!==l||0!==c?(i.editor.move(l,c),e.requestRender(),!0):"Delete"===r.key&&(o&&o(),e.requestRender(),!0)},s}(f))},t.createTextKeyboardListener=function(e,n,i,o){return new(function(r){function s(){return null!==r&&r.apply(this,arguments)||this}return d(s,r),s.prototype.onkeydown=function(r){var s=n.screenSizeToCanvas(1),a=t.getMove(r,s),l=a.dx,c=a.dy;return 0!==l||0!==c?(i.setPosition(i.x+l,i.y+c),e.requestRender(),!0):"Delete"===r.key&&(o&&o(),e.requestRender(),!0)},s}(f))},t.getMove=function(t,e){var n=0,i=0;switch(t.shiftKey&&(e*=10),t.key){case"w":case"W":case"ArrowUp":i-=e;break;case"a":case"A":case"ArrowLeft":n-=e;break;case"s":case"S":case"ArrowDown":i+=e;break;case"d":case"D":case"ArrowRight":n+=e}return{dx:n,dy:i}},t.copyToClipboard=function(t){var e=document.getElementById(t);e.select(),document.execCommand("Copy"),e.blur()},t.setContent=function(t,e){document.getElementById(t).innerHTML=e},t.bindButtonOnClick=function(t,e){document.getElementById(t).onclick=e},t.setVisibility=function(t,e,n){void 0===n&&(n="block"),document.getElementById(t).style.display=e?n:"none"},t.bindCheckbox=function(t,e,n){var i=document.getElementById(t);i.checked=e,i.onchange=function(t){n(i.checked)}},t.bindSelect=function(t,e,n,i){var o=document.getElementById(t);o.options.length=0;for(var r=0,s=e;r<s.length;r++){var a=s[r];o.add(new Option(a,a))}var l=e.indexOf(n);l>0&&(o.options[l].selected=!0),o.onchange=function(t){i(o.selectedIndex,o.options[o.selectedIndex].value)}},t.bindValue=function(t,e,n){var i=document.getElementById(t);i.value=e,i.oninput=i.onchange=function(t){n(i.value)}},t.bindColor=function(t,e,n,i,o){var r=document.getElementById(t),s=document.getElementById(e);r.innerHTML="",s.innerHTML="";for(var a=n,l=i,h=0,p=c.list;h<p.length;h++){var f=p[h],d=t+"_"+f.name,y="background:"+f.name;r.innerHTML=r.innerHTML+'<button id="'+d+'" class="configColorButton" style="'+y+'"></button>\n'}for(var v=0,m=u.list;v<m.length;v++){var g=m[v];d=e+"_"+g.name,y="background:"+g.buttonColor;s.innerHTML=s.innerHTML+'<button id="'+d+'" class="configAlphaButton" style="'+y+'"></button>\n'}for(var x=function(e){var n=t+"_"+e.name;document.getElementById(n).onclick=function(t){o(a=e,l)}},b=0,C=c.list;b<C.length;b++){x(f=C[b])}for(var w=function(t){var n=e+"_"+t.name;document.getElementById(n).onclick=function(e){o(a,l=t)}},_=0,E=u.list;_<E.length;_++){w(g=E[_])}},t.bindNumber=function(t,e,n){var i=document.getElementById(t);i.value=e.toString(),i.oninput=i.onchange=function(t){var e=parseFloat(i.value);e>=0?n(e):(i.value="0",n(0))}},t}(),v=function(){function t(t,e){this.renderNext=!1,this.map=null,this.data=null,this.domElement=t,this.domElement.innerHTML+='<canvas id="'+e+"\" tabindex='0' style='width:100%;height:100%;overflow:hidden;display:inline-block;'></canvas>",this.domElement.oncontextmenu=function(t){return!1},this.canvasElement=document.getElementById(e),this.context=this.canvasElement.getContext("2d"),this.camera=new a,this.renderer=new o(this,this.canvasElement,this.context),this.width=this.canvasElement.clientWidth,this.height=this.canvasElement.clientHeight;var n=this;window.addEventListener("resize",(function(){n.requestRender()}))}return t.prototype.getCamera=function(){return this.camera},t.prototype.init=function(){var t=this;this.layers=[];var e=function(t){return{button:t.button,buttons:t.buttons,offsetX:t.offsetX*window.devicePixelRatio,offsetY:t.offsetY*window.devicePixelRatio,movementX:t.movementX*window.devicePixelRatio,movementY:t.movementY*window.devicePixelRatio,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey}};if(this.canvasElement.onclick=function(n){var i=e(n);t.canvasElement.focus(),n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation();for(var o=t.layers.length-1;o>=0;o--){var r=t.layers[o];if(r.mouseListener&&r.mouseListener.onclick(i))break}},this.canvasElement.ondblclick=function(n){var i=e(n);n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation();for(var o=t.layers.length-1;o>=0;o--){var r=t.layers[o];if(r.mouseListener&&r.mouseListener.ondblclick(i))break}},this.canvasElement.onwheel=function(e){var n=function(t){return{button:t.button,buttons:t.buttons,offsetX:t.offsetX*window.devicePixelRatio,offsetY:t.offsetY*window.devicePixelRatio,movementX:t.movementX*window.devicePixelRatio,movementY:t.movementY*window.devicePixelRatio,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,deltaX:t.deltaX,deltaY:t.deltaY}}(e);e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();for(var i=t.layers.length-1;i>=0;i--){var o=t.layers[i];if(o.mouseListener&&o.mouseListener.onwheel(n))break}},this.canvasElement.onmousedown=function(n){var i=e(n);n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation();for(var o=t.layers.length-1;o>=0;o--){var r=t.layers[o];if(r.mouseListener&&r.mouseListener.onmousedown(i))break}},this.canvasElement.onmouseup=function(n){var i=e(n);n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation();for(var o=t.layers.length-1;o>=0;o--){var r=t.layers[o];if(r.mouseListener&&r.mouseListener.onmouseup(i))break}},this.canvasElement.onmousemove=function(n){var i=e(n);n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation();for(var o=t.layers.length-1;o>=0;o--){var r=t.layers[o];if(r.mouseListener&&r.mouseListener.onmousemove(i))break}},this.canvasElement.onmouseout=function(n){var i=e(n);n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation();for(var o=t.layers.length-1;o>=0;o--){var r=t.layers[o];if(r.mouseListener&&r.mouseListener.onmouseout(i))break}},this.canvasElement.onkeydown=function(e){for(var n=t.layers.length-1;n>=0;n--){var i=t.layers[n];if(i.keyboardListener&&i.keyboardListener.onkeydown(e)){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();break}}},this.canvasElement.onkeyup=function(e){for(var n=t.layers.length-1;n>=0;n--){var i=t.layers[n];if(i.keyboardListener&&i.keyboardListener.onkeyup(e)){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();break}}},this.canvasElement.onkeypress=function(e){for(var n=t.layers.length-1;n>=0;n--){var i=t.layers[n];if(i.keyboardListener&&i.keyboardListener.onkeypress(e)){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();break}}},y.isMobile()){var n=new Hammer(this.canvasElement);n.get("pan").set({direction:Hammer.DIRECTION_ALL}),n.on("pan",(function(e){e.deltaX*=window.devicePixelRatio,e.deltaY*=window.devicePixelRatio,e.preventDefault();for(var n=t.layers.length-1;n>=0;n--){var i=t.layers[n];if(i.mouseListener&&i.mouseListener.onpan(e))break}}))}},t.prototype.addLayer=function(t){this.layers.push(t)},t.prototype.findLayer=function(t){for(var e=0,n=this.layers;e<n.length;e++){var i=n[e];if(i.name==t)return i}return null},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.requestRender=function(){if(!this.renderNext){this.renderNext=!0;var t=this;requestAnimationFrame((function(){t.renderNext=!1,t.render()}))}},t.prototype.loadMap=function(t){if(!this.map||this.map.name!=t.name){this.camera.load(this,t);for(var e=0,n=this.layers;e<n.length;e++){n[e].loadMap(t)}}this.map=t},t.prototype.loadData=function(t){if(this.data!=t)for(var e=0,n=this.layers;e<n.length;e++){n[e].loadData(t)}this.data=t},t.prototype.save=function(){for(var t=new l,e=0,n=this.layers;e<n.length;e++){n[e].saveData(t)}return t},t.prototype.render=function(){this.width=this.canvasElement.clientWidth*window.devicePixelRatio,this.height=this.canvasElement.clientHeight*window.devicePixelRatio,this.canvasElement.width!==this.width&&(this.canvasElement.width=this.width),this.canvasElement.height!==this.height&&(this.canvasElement.height=this.height),this.camera.action(),this.renderer.clear();for(var t=0,e=this.layers;t<e.length;t++){e[t].render(this.renderer)}},t}(),m=function(){function t(){}return t.get=function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&200==n.status&&e(n.responseText)},n.open("GET",t,!0),n.send()},t}(),g=function(){function t(t,e){this._mouseListener=null,this._keyboardListener=null,this.name=t,this.canvas=e,this.camera=e.getCamera()}return Object.defineProperty(t.prototype,"mouseListener",{get:function(){return this._mouseListener},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keyboardListener",{get:function(){return this._keyboardListener},enumerable:!0,configurable:!0}),t.prototype.loadMap=function(t){},t.prototype.loadData=function(t){},t.prototype.saveData=function(t){},t.prototype.render=function(t){},t.prototype.unload=function(){},t}(),x=function(){function t(){this.transformation=new r}return t.prototype.render=function(t,e,n){},t}(),b=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),C=function(t){function e(e,n,i,o,r,s){var a=t.call(this)||this;a.transformation.position.x=n,a.transformation.position.y=i,a.w=o,a.h=r,a.img=new Image,a.src=e,a.loaded=!1;var l=a;return a.img.onload=function(t){a.loaded=!0,s&&s(l)},a}return b(e,t),e.prototype.loadIfNotLoaded=function(){this.loading||(this.loading=!0,this.img.src=this.src)},e.prototype.render=function(t,e,n){var i=e.testImageVisibility(n,this.img,this.transformation,this.w,this.h,100);i&&(this.loadIfNotLoaded(),this.loaded&&e.drawImage(this.img,i))},e}(x),w=function(){function t(){}return t.prototype.onclick=function(t){return!1},t.prototype.ondblclick=function(t){return!1},t.prototype.onwheel=function(t){return!1},t.prototype.onmousedown=function(t){return!1},t.prototype.onmouseup=function(t){return!1},t.prototype.onmousemove=function(t){return!1},t.prototype.onmouseout=function(t){return!1},t.prototype.onpan=function(t){return!1},t}(),_=function(){function t(){}return t.register=function(t,e,n){t?(e&&(this.mapSelect[t]=this.mapSelect[t]||[],this.mapSelect[t].push(e)),n&&(this.mapDeselect[t]=this.mapDeselect[t]||[],this.mapDeselect[t].push(n))):this.listDeselect.push(n)},t.deselectAny=function(){this.selected&&this.deselect(this.selectedType)},t.deselect=function(t){if(this.selectedType==t){var e=this.mapDeselect[t];if(e)for(var n=0,i=e;n<i.length;n++){(0,i[n])()}for(var o=0,r=this.listDeselect;o<r.length;o++){(0,r[o])()}this.selectedType=null,this.selected=null}},t.select=function(t,e){this.deselectAny(),this.selected=e,this.selectedType=t;var n=this.mapSelect[t];if(n)for(var i=0,o=n;i<o.length;i++){(0,o[i])(e)}},t.listDeselect=[],t.mapSelect={},t.mapDeselect={},t}(),E=function(){function t(){}return t.IMAGE="image",t.POLYLINE_CREATE="polyline_create",t.POLYLINE_EDIT="polyline_edit",t.POLYLINE_VIEW="polyline_view",t.TEXT_CREATE="text_create",t.TEXT_EDIT="text_edit",t.TEXT_VIEW="text_view",t}(),T=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),k=function(t){function e(n){var i=t.call(this,E.IMAGE,n)||this;return _.register(null,null,(function(){y.setContent(e.HINT_ELEMENT_ID,e.HINT_VIEW)})),y.setContent(e.HINT_ELEMENT_ID,e.HINT_VIEW),i}return T(e,t),e.prototype.loadMap=function(t){var e=this;this.map=t,this.maxLevel=t.maxLevel;var n=t.githubRepo.indexOf("/"),i=t.githubRepo.substring(0,n),o=t.githubRepo.substring(n+1);this.baseFolder="https://"+i+".github.io/"+o+"/"+this.map.name,this.currentZoom=-1;var r=document.getElementById("imageSource");y.setVisibility("imageSource",!!t.source,"inline"),t.source&&(r.href=t.source,r.innerHTML=t.source),y.bindButtonOnClick("buttonZoomIn",(function(){e.camera.changeZoomBy(-1),e.camera.action(),e.canvas.requestRender()})),y.bindButtonOnClick("buttonZoomOut",(function(){e.camera.changeZoomBy(1),e.camera.action(),e.canvas.requestRender()}));var s=this;this._mouseListener=new(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.down=!1,e.lastX=-1,e.lastY=-1,e.lastPanX=-1,e.lastPanY=-1,e}return T(e,t),e.prototype.onwheel=function(t){var e=s.canvas.getCamera();e.action();var n=t.offsetX,i=t.offsetY,o=e.screenXyToCanvas(n,i);e.changeZoomBy(t.deltaY>0?1:-1),e.action();var r=e.screenXyToCanvas(n,i),a=o.x-r.x,l=o.y-r.y;return e.moveXy(a,l),s.canvas.requestRender(),!0},e.prototype.onmousedown=function(t){return this.down=!0,this.lastX=t.offsetX,this.lastY=t.offsetY,!0},e.prototype.onmouseup=function(t){return this.down=!1,!0},e.prototype.onmousemove=function(t){if(this.down&&t.buttons>0){var e=s.canvas.getCamera();e.action();var n=t.offsetX,i=t.offsetY,o=e.screenXyToCanvas(this.lastX,this.lastY),r=e.screenXyToCanvas(n,i),a=o.x-r.x,l=o.y-r.y;return e.moveXy(a,l),this.lastX=n,this.lastY=i,s.canvas.requestRender(),!0}return!1},e.prototype.onpan=function(t){var e=t.deltaX-this.lastPanX,n=t.deltaY-this.lastPanY,i=s.canvas.getCamera(),o=i.screenSizeToCanvas(1);return i.moveXy(-e*o,-n*o),s.canvas.requestRender(),this.lastPanX=t.deltaX,this.lastPanY=t.deltaY,t.isFinal&&(this.lastPanX=0,this.lastPanY=0),!0},e}(w))},e.prototype.prepare=function(t,e){var n=t.getZoom();if(this.currentZoom!==n){this.currentZoom=n;var i=this.map.tileSize<<n,o=this.map.levels[n];this.xCount=o.xMax,this.yCount=o.yMax,this.imageMatrix=[];for(var r=0;r<this.xCount;r++){this.imageMatrix[r]=[];for(var s=0;s<this.yCount;s++)this.imageMatrix[r][s]=new C(this.baseFolder+"/"+n+"/"+r+"_"+s+".jpg",r*i,s*i,i,i,(function(t){e.requestRender()}))}}},e.prototype.render=function(t){this.prepare(this.camera,this.canvas);var e=this.camera.screenSizeToCanvas(1);if(y.setContent("textZoomInfo",(e>1?"1/":"")+e+"x"),this.imageMatrix)for(var n=0;n<this.xCount;n++)for(var i=0;i<this.yCount;i++)this.imageMatrix[n][i].render(this.canvas,t,this.camera)},e.prototype.unload=function(){t.prototype.unload.call(this)},e.HINT_ELEMENT_ID="hint",e.HINT_VIEW="1. hold mouse button to drag<br>2. left click polygon/text to select<br>3. mouse wheel to zoom<br>",e}(g),S=function(){function t(t,e,n){this.onScreen=t,this.onCanvas=e||0,this.ofScreen=n||0}return t.clone=function(e){return new t(e.onScreen,e.onCanvas,e.ofScreen)},t}(),P=function(){function t(t,e,n,i){void 0===t&&(t=Math.min()),void 0===e&&(e=Math.min()),void 0===n&&(n=Math.max()),void 0===i&&(i=Math.max()),this.x1=t,this.y1=e,this.x2=n,this.y2=i}return t.prototype.set=function(t,e,n,i){this.x1=t,this.y1=e,this.x2=n,this.y2=i},t}(),I=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),L=function(t,e){this.x=t,this.y=e},O=function(t,e,n,i){this.position=t,this.p1Index=e,this.p2Index=n,this.distance=i},N=function(t,e,n,i,o,r,s,a,l){this.points=t,this.closed=e,this.lineWidth=n,this.fill=i,this.fillColorName=o,this.fillAlphaName=r,this.stroke=s,this.strokeColorName=a,this.strokeAlphaName=l},A=function(){function t(t,e){this.polyline=t,this.points=e}return t.sqr=function(t,e){return t*t+e*e},t.testPointSegment=function(e,n,i,o,r){var s=e[n],a=e[i],l=a.x-s.x,c=a.y-s.y,u=t.sqr(l,c);if(u<1e-4)return null;var h=((o-s.x)*l+(r-s.y)*c)/u;h>1&&(h=1),h<0&&(h=0);var p=s.x+h*l,f=s.y+h*c,d=t.sqr(o-p,r-f);return new O(new L(p,f),n,i,Math.sqrt(d))},t.testPointPolygon=function(t,e,n){for(var i=t.length,o=!1,r=0,s=i-1;r<i;s=r++)t[r].y>n!=t[s].y>n&&e<(t[s].x-t[r].x)*(n-t[r].y)/(t[s].y-t[r].y)+t[r].x&&(o=!o);return o},t.prototype.pickPoint=function(e,n,i){for(var o=i*i,r=this.points,s=0,a=r;s<a.length;s++){var l=a[s];if(t.sqr(l.x-e,l.y-n)<=o)return r.indexOf(l)}return null},t.prototype.pickLine=function(e,n,i){for(var o=null,r=Number.MAX_VALUE,s=this.points,a=s.length,l=0,c=a-1;l<a;c=l++){var u=t.testPointSegment(s,l,c,e,n);u&&u.distance<i&&u.distance<r&&(r=u.distance,o=u)}return o},t.prototype.pickShape=function(e,n){return this.polyline.style.fill&&t.testPointPolygon(this.points,e,n)},t}(),M=function(){function t(t,e){this.polyline=t,this.points=e}return t.prototype.forEachPoint=function(t){this.points.forEach((function(e,n){t(e.x,e.y,n)}))},t.prototype.pointCount=function(){return this.points.length},t.prototype.getPoint=function(t){var e=this.points;return e[t=(t+e.length)%e.length]},t.prototype.addPoint=function(t,e){this.points.push(new L(t,e)),this.polyline.invalidate()},t.prototype.insertPoint=function(t,e,n){void 0===n&&(n=-1);var i=this.points;n=(n+i.length)%i.length,i.splice(n,0,new L(t,e)),this.polyline.invalidate()},t.prototype.removePoint=function(t){var e=this.points;t=(t+e.length)%e.length,e.splice(t,1),this.polyline.invalidate()},t.prototype.setPoint=function(t,e,n){var i=this.points,o=i[t=(t+i.length)%i.length];o.x=e,o.y=n,this.polyline.invalidate()},t.prototype.move=function(t,e){for(var n=0,i=this.points;n<i.length;n++){var o=i[n];o.x+=t,o.y+=e}this.polyline.invalidate()},t.prototype.flipX=function(){for(var t=Math.min(),e=Math.max(),n=0,i=this.points;n<i.length;n++){var o=i[n];t=Math.min(t,o.x),e=Math.max(e,o.x)}for(var r=t+e,s=0,a=this.points;s<a.length;s++){(o=a[s]).x=r-o.x}},t.prototype.flipY=function(){for(var t=Math.min(),e=Math.max(),n=0,i=this.points;n<i.length;n++){var o=i[n];t=Math.min(t,o.y),e=Math.max(e,o.y)}for(var r=t+e,s=0,a=this.points;s<a.length;s++){(o=a[s]).y=r-o.y}},t.prototype.rotateCW=function(){for(var t=this.polyline.calculator.aabbCenter(),e=0,n=this.points;e<n.length;e++){var i=n[e],o=i.x-t.x,r=i.y-t.y;i.x=t.x-r,i.y=t.y+o}},t.prototype.rotateCCW=function(){for(var t=this.polyline.calculator.aabbCenter(),e=0,n=this.points;e<n.length;e++){var i=n[e],o=i.x-t.x,r=i.y-t.y;i.x=t.x+r,i.y=t.y-o}},t}(),R=function(){function t(t,e){this.polyline=t,this.points=e}return t.prototype.centroid=function(){for(var t=0,e=0,n=0,i=0;i<this.points.length;i++){var o=this.points[i],r=this.points[(i+1)%this.points.length],s=o.x*r.y-r.x*o.y;t+=s,e+=(o.x+r.x)*s,n+=(o.y+r.y)*s}return new L(e/6/(t/2),n/6/(t/2))},t.prototype.aabb=function(t){void 0===t&&(t=new P),t||(t=new P);for(var e=Math.min(),n=Math.max(),i=Math.min(),o=Math.max(),r=0,s=this.points;r<s.length;r++){var a=s[r];e=Math.min(e,a.x),n=Math.max(n,a.x),i=Math.min(i,a.y),o=Math.max(o,a.y)}return t.set(e,i,n,o),t},t.prototype.aabbCenter=function(){var t=this.aabb();return new L((t.x1+t.x2)/2,(t.y1+t.y2)/2)},t.prototype.area=function(){if(this.points.length<3)return 0;for(var t=this.points[0].y*(this.points[this.points.length-1].x-this.points[1].x),e=1;e<this.points.length;e++)t+=this.points[e].y*(this.points[e-1].x-this.points[(e+1)%this.points.length].x);return Math.abs(.5*t)},t.prototype.length=function(){if(this.points.length<2)return 0;var e=0,n=this.points[0],i=this.points[this.points.length-1];this.polyline.style.closed&&(e=t.hypot(n.x-i.x,n.y-i.y));for(var o=0;o<this.points.length-1;o++){var r=this.points[o],s=this.points[o+1];e+=t.hypot(r.x-s.x,r.y-s.y)}return e},t.hypot=function(t,e){return Math.sqrt(t*t+e*e)},t.prototype.alignPoint=function(t,e){t=(t+this.points.length)%this.points.length;var n=this.points[t],i=n.x,o=n.y,r=this.points[(t+1)%this.points.length];if(Math.abs(r.x-n.x)<=e&&(i=r.x),Math.abs(r.y-n.y)<=e&&(o=r.y),this.points.length>2){var s=this.points[(t-1+this.points.length)%this.points.length];Math.abs(s.x-n.x)<=e&&(i=s.x),Math.abs(s.y-n.y)<=e&&(o=s.y)}return new L(i,o)},t}(),B=function(){function t(t){this._closed=t.closed,this._lineWidth=t.lineWidth,this._fill=t.fill,this._fillColor=c.findByName(t.fillColorName),this._fillAlpha=u.findByName(t.fillAlphaName),this._fillString=h(this._fillColor,this._fillAlpha),this._stroke=t.stroke,this._strokeColor=c.findByName(t.strokeColorName),this._strokeAlpha=u.findByName(t.strokeAlphaName),this._strokeString=h(this._strokeColor,this._strokeAlpha)}return Object.defineProperty(t.prototype,"closed",{get:function(){return this._closed},set:function(t){this._closed=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineWidth",{get:function(){return this._lineWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return this._fill},set:function(t){this._fill=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillColor",{get:function(){return this._fillColor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillAlpha",{get:function(){return this._fillAlpha},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillString",{get:function(){return this._fillString},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stroke",{get:function(){return this._stroke},set:function(t){this._stroke=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strokeColor",{get:function(){return this._strokeColor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strokeAlpha",{get:function(){return this._strokeAlpha},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strokeString",{get:function(){return this._strokeString},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onScreen",{get:function(){return this._lineWidth.onScreen},set:function(t){this._lineWidth.onScreen=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onCanvas",{get:function(){return this._lineWidth.onCanvas},set:function(t){this._lineWidth.onCanvas=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ofScreen",{get:function(){return this._lineWidth.ofScreen},set:function(t){this._lineWidth.ofScreen=t},enumerable:!0,configurable:!0}),t.prototype.pack=function(){return new N(null,this._closed,S.clone(this._lineWidth),this._fill,this._fillColor.name,this._fillAlpha.name,this._stroke,this._strokeColor.name,this._strokeAlpha.name)},t.prototype.setFillColor=function(t,e){this._fillColor=t,this._fillAlpha=e,this._fillString=h(this._fillColor,this._fillAlpha)},t.prototype.setStrokeColor=function(t,e){this._strokeColor=t,this._strokeAlpha=e,this._strokeString=h(this._strokeColor,this._strokeAlpha)},t}(),X=function(t){function e(e){var n=t.call(this)||this;return n.canvasAABB=new P,n.valid=!1,n.points=e.points,n.style=new B(e),n.picker=new A(n,n.points),n.editor=new M(n,n.points),n.calculator=new R(n,n.points),n}return I(e,t),e.prototype.clone=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);for(var n=[],i=0,o=this.points;i<o.length;i++){var r=o[i];n.push(new L(r.x+t,r.y+e))}var s=this.style.pack();return s.points=n,s},e.prototype.pack=function(){var t=this.style.pack();return t.points=this.points,t},e.prototype.invalidate=function(){this.valid=!1},e.prototype.validate=function(){this.valid||this.calculator.aabb(this.canvasAABB)},e.prototype.render=function(t,e,n){this.validate(),n.canvasAABBInScreen(this.canvasAABB)&&(e.setFillColor(this.style.fillString),e.setStrokeColor(this.style.strokeString),e.renderPolyline(n,this.points,this.style.closed,this.style.fill,this.style.stroke,this.style.lineWidth))},e}(x),D=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),q=function(t){function e(e){var n=t.call(this,E.POLYLINE_VIEW,e)||this;return n.polylines=[],n}return D(e,t),e.prototype.loadData=function(t){if(this.polylines=[],t.polylines)for(var e=0,n=t.polylines;e<n.length;e++){var i=n[e];this.polylines.push(new X(i))}var o=this;this._mouseListener=new(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.moved=!1,e}return D(e,t),e.prototype.onmousedown=function(t){return this.moved=!1,!1},e.prototype.onmouseup=function(t){if(0!=t.button||this.moved)return!1;for(var e=o.camera.screenSizeToCanvas(5),n=o.camera.screenXyToCanvas(t.offsetX,t.offsetY),i=n.x,r=n.y,s=null,a=0,l=o.polylines;a<l.length;a++){var c=l[a],u=c.picker.pickPoint(i,r,e),h=c.picker.pickLine(i,r,e),p=c.picker.pickShape(i,r);(null!=u||h||p)&&(s=c)}return s?(_.select(E.POLYLINE_EDIT,s),!0):(_.deselect(E.POLYLINE_CREATE),_.deselect(E.POLYLINE_EDIT),!1)},e.prototype.onmousemove=function(t){return 1&t.buttons&&0!=t.movementX&&0!=t.movementY&&(this.moved=!0),!1},e}(w))},e.prototype.addPolyline=function(t){this.polylines.push(t),this.canvas.requestRender()},e.prototype.deletePolyline=function(t){var e=this.polylines.indexOf(t);return-1!==e&&(this.polylines.splice(e,1),!0)},e.prototype.containPolyline=function(t){return this.polylines.indexOf(t)>=0},e.prototype.saveData=function(t){t.polylines=[];for(var e=0,n=this.polylines;e<n.length;e++){var i=n[e];t.polylines.push(i.pack())}},e.prototype.render=function(e){t.prototype.render.call(this,e);for(var n=0,i=this.polylines;n<i.length;n++){i[n].render(this.canvas,e,this.camera)}},e.prototype.unload=function(){t.prototype.unload.call(this)},e}(g),Y=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),z=function(t){function e(e){var n=t.call(this,E.POLYLINE_EDIT,e)||this;n.polylineEdit=null;var i=n;return _.register(E.POLYLINE_EDIT,(function(t){n.startEditingPolyline(t)}),(function(){i.finishEditing()})),n}return Y(e,t),e.prototype.loadMap=function(t){this.map=t},e.prototype.loadData=function(t){this.layerView=this.canvas.findLayer(E.POLYLINE_VIEW),this.polylineEdit=null,this.finishEditing(),y.setVisibility("panelPolylineSelected",!1)},e.prototype.startEditingPolyline=function(t){var n=this;this.finishEditing(),this.polylineEdit=t,this.bindPolylineConfigUi(this.polylineEdit),y.setContent(e.HINT_ELEMENT_ID,e.HINT_EDIT_POLYLINE);var i=this;this._mouseListener=new(function(n){function o(){var t=null!==n&&n.apply(this,arguments)||this;return t.down=!1,t.moved=!1,t.dragPointIndex=null,t.dragShape=!1,t.dragShapeX=-1,t.dragShapeY=-1,t}return Y(o,n),o.prototype.onmousedown=function(e){if(this.dragPointIndex=null,0==e.button){this.down=!0;var n=i.camera.screenXyToCanvas(e.offsetX,e.offsetY),o=t.picker.pickPoint(n.x,n.y,i.camera.screenSizeToCanvas(5));if(null!=o)return this.dragPointIndex=o,!0;var r=t.picker.pickShape(n.x,n.y);if(null==o&&r&&e.altKey){if(e.ctrlKey){var s=new X(t.clone());i.layerView.addPolyline(s)}this.dragShape=!0,this.dragShapeX=n.x,this.dragShapeY=n.y}}else 2==e.button&&(this.moved=!1);return!1},o.prototype.onmouseup=function(e){var n=null!=this.dragPointIndex||!!this.dragShape;if(this.dragPointIndex=null,this.dragShape=!1,this.dragShapeX=-1,this.dragShapeY=-1,0==e.button)return this.down=!1,n;if(2==e.button){var o=!1;if(!this.moved){var r=i.camera.screenXyToCanvas(e.offsetX,e.offsetY),s=t.picker.pickPoint(r.x,r.y,i.camera.screenSizeToCanvas(5));null!=s&&(t.editor.pointCount()>3&&(t.editor.removePoint(s),i.canvas.requestRender()),o=!0)}return this.moved=!1,o}return!1},o.prototype.ondblclick=function(e){if(0==e.button){var n=i.camera.screenXyToCanvas(e.offsetX,e.offsetY),o=t.picker.pickPoint(n.x,n.y,i.camera.screenSizeToCanvas(5));if(null!=o)return t.editor.pointCount()>3&&(t.editor.removePoint(o),i.canvas.requestRender()),!0;var r=t.picker.pickLine(n.x,n.y,i.camera.screenSizeToCanvas(5));if(r){var s=r.p1Index;return t.editor.insertPoint(r.position.x,r.position.y,s),i.canvas.requestRender(),!0}}return!1},o.prototype.onmousemove=function(n){if(this.down){var o=i.camera.screenXyToCanvas(n.offsetX,n.offsetY);if(null!=this.dragPointIndex){if(t.editor.setPoint(this.dragPointIndex,o.x,o.y),n.ctrlKey){var r=i.camera.screenSizeToCanvas(e.MAG_RADIUS),s=t.calculator.alignPoint(this.dragPointIndex,r);t.editor.setPoint(this.dragPointIndex,s.x,s.y)}return i.canvas.requestRender(),!0}if(this.dragShape)return t.editor.move(o.x-this.dragShapeX,o.y-this.dragShapeY),this.dragShapeX=o.x,this.dragShapeY=o.y,i.canvas.requestRender(),!0}else 2&n.buttons&&(this.moved=!0);return!1},o}(w)),this._keyboardListener=y.createPolylineKeyboardListener(i.canvas,i.camera,i.polylineEdit,(function(){n.deleteEditing(),_.deselect(E.POLYLINE_EDIT)})),this.canvas.requestRender()},e.prototype.finishEditing=function(){y.setVisibility("panelPolylineSelected",!1),this.polylineEdit&&(this.polylineEdit=null,this.canvas.requestRender()),this._mouseListener=null,this._keyboardListener=null},e.prototype.render=function(t){var e=this;this.polylineEdit&&this.polylineEdit.editor.forEachPoint((function(n,i){e.drawPointCircle(n,i,t)}))},e.prototype.drawPointCircle=function(t,e,n){var i=this.camera.canvasToScreen(t,e);n.setColor("rgba(255,255,255,1)"),n.drawCircle(i.x,i.y,5,!1,!0,1),n.setColor("rgba(0,0,0,0.5)"),n.drawCircle(i.x,i.y,4,!0,!1)},e.prototype.deleteEditing=function(){this.polylineEdit&&(this.layerView.deletePolyline(this.polylineEdit),this.finishEditing())},e.prototype.bindPolylineConfigUi=function(t){var e=this;y.setVisibility("panelPolylineSelected",!0),y.bindButtonOnClick("polylineButtonCopy",(function(){var n=e.canvas.getCamera().screenSizeToCanvas(20),i=new X(t.clone(n,n));e.finishEditing(),e.layerView.addPolyline(i),e.startEditingPolyline(i),e.canvas.requestRender()})),y.bindButtonOnClick("polylineButtonArea",(function(){if(y.setContent("polylineTextArea",""),t.style.fill){var n=e.map.widthMillimeter,i=e.map.heightMillimeter,o="mm^2";e.map.widthMillimeter>0&&e.map.heightMillimeter>0||(n=e.map.width,i=e.map.height,o="pixels");var r=t.calculator.area()/e.map.width/e.map.height*n*i;r=Math.round(100*r)/100,y.setContent("polylineTextArea",r+o)}else{n=e.map.widthMillimeter,i=e.map.heightMillimeter,o="mm";e.map.widthMillimeter>0&&e.map.heightMillimeter>0||(n=e.map.width,i=e.map.height,o="pixels");var s=t.calculator.length()*Math.sqrt(n*i/e.map.width/e.map.height);s=Math.round(100*s)/100,y.setContent("polylineTextArea",s+o)}})),y.setContent("polylineTextArea",""),y.bindButtonOnClick("polylineButtonRotateCCW",(function(){t.editor.rotateCCW(),e.canvas.requestRender()})),y.bindButtonOnClick("polylineButtonRotateCW",(function(){t.editor.rotateCW(),e.canvas.requestRender()})),y.bindButtonOnClick("polylineButtonFlipX",(function(){t.editor.flipX(),e.canvas.requestRender()})),y.bindButtonOnClick("polylineButtonFlipY",(function(){t.editor.flipY(),e.canvas.requestRender()})),y.bindCheckbox("polylineCheckboxFill",t.style.fill,(function(n){t.style.fill=n,e.canvas.requestRender()})),y.bindCheckbox("polylineCheckboxStroke",t.style.stroke,(function(n){t.style.stroke=n,e.canvas.requestRender()})),y.bindCheckbox("polylineCheckboxClosed",t.style.closed,(function(n){t.style.closed=n,e.canvas.requestRender()})),y.bindNumber("polylineTextSizeOnScreen",t.style.onScreen,(function(n){t.style.onScreen=n,e.canvas.requestRender()})),y.bindNumber("polylineTextSizeOnCanvas",t.style.onCanvas,(function(n){t.style.onCanvas=n,e.canvas.requestRender()})),y.bindNumber("polylineTextSizeOfScreen",1e3*t.style.ofScreen,(function(n){t.style.ofScreen=.001*n,e.canvas.requestRender()})),y.bindColor("polylineContainerStrokeColor","polylineContainerStrokeAlpha",t.style.strokeColor,t.style.strokeAlpha,(function(n,i){t.style.setStrokeColor(n,i),e.canvas.requestRender()})),y.bindColor("polylineContainerFillColor","polylineContainerFillAlpha",t.style.fillColor,t.style.fillAlpha,(function(n,i){t.style.setFillColor(n,i),e.canvas.requestRender()}))},e.HINT_ELEMENT_ID="hint",e.HINT_EDIT_POLYLINE="1. hold left button to drag points<br>2. hold ctrl to help with horizontal/vertical line<br>3. hold alt to drag polyline<br>4. hold ctrl+alt to copy and drag polyline<br>5. double click on line to create point<br>6. right-click / double left-click point to delete it<br>7. WSAD ↑↓←→ to move, hold shift to speed up<br>8. press del to delete<br>",e.MAG_RADIUS=10,e}(g),W=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),V=function(t,e,n,i,o,r){this.text="",this.text=t,this.colorName=e,this.alphaName=n,this.fontSize=i,this.x=o,this.y=r},j=function(t){function e(e){var n=t.call(this)||this;return n._text="",n._canvasAABB=new P,n.sizeValid=!1,n.canvasZoom=-1,n.canvasWidth=0,n.canvasHeight=0,n.screenWidth=0,n.screenHeight=0,n._text=e.text,n.color=c.findByName(e.colorName),n.alpha=u.findByName(e.alphaName),n.colorString=h(n.color,n.alpha),n.fontSize=e.fontSize,n._x=e.x,n._y=e.y,n}return W(e,t),e.prototype.invalidate=function(){this.sizeValid=!1},Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.validateCanvasAABB=function(t,e){return this.validate(t,e),this._canvasAABB},Object.defineProperty(e.prototype,"onScreen",{get:function(){return this.fontSize.onScreen},set:function(t){this.fontSize.onScreen=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onCanvas",{get:function(){return this.fontSize.onCanvas},set:function(t){this.fontSize.onCanvas=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ofScreen",{get:function(){return this.fontSize.ofScreen},set:function(t){this.fontSize.ofScreen=t,this.invalidate()},enumerable:!0,configurable:!0}),e.prototype.setPosition=function(t,e){this._x=t,this._y=e,this.invalidate()},e.prototype.setColorAlpha=function(t,e){this.color=t,this.alpha=e,this.colorString=h(this.color,this.alpha)},e.prototype.clone=function(t,e){return new V(this._text,this.color.name,this.alpha.name,S.clone(this.fontSize),this._x+t,this._y+e)},e.prototype.pack=function(){return new V(this._text,this.color.name,this.alpha.name,S.clone(this.fontSize),this._x,this._y)},e.prototype.render=function(t,e,n){e.setColor(this.colorString),this.validate(n,e),n.canvasAABBInScreen(this._canvasAABB)&&e.renderText(n,this._text,this.screenHeight,this._x,this._y,"center","middle")},e.prototype.validate=function(t,e){if(!this.sizeValid||this.canvasZoom!=t.getZoom()){this.sizeValid=!0;var n=e.measureText(t,this._text,this.fontSize),i=t.screenSizeToCanvas(1);this.canvasZoom=t.getZoom(),this.canvasWidth=n[0]*i/2,this.canvasHeight=n[1]*i/2,this.screenWidth=n[0],this.screenHeight=n[1],this.calcCanvasAABB()}},e.prototype.pick=function(t,e,n){var i=this._x-this.canvasWidth-n<=t&&t<=this._x+this.canvasWidth+n,o=this._y-this.canvasHeight-n<=e&&e<=this._y+this.canvasHeight+n;return i&&o},e.prototype.calcCanvasAABB=function(){return this._canvasAABB.x1=this.x-this.canvasWidth,this._canvasAABB.y1=this.y-this.canvasHeight,this._canvasAABB.x2=this.x+this.canvasWidth,this._canvasAABB.y2=this.y+this.canvasHeight,this._canvasAABB},e}(x),H=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),K=function(t){function e(e){var n=t.call(this,E.TEXT_EDIT,e)||this;n.textEdit=null;var i=n;return _.register(E.TEXT_EDIT,(function(t){i.startEditingText(t)}),(function(){i.finishEditing()})),n}return H(e,t),e.prototype.loadData=function(t){this.layerView=this.canvas.findLayer(E.TEXT_VIEW),this.finishEditing(),y.setVisibility("panelTextSelected",!1)},e.prototype.startEditingText=function(t){var n=this;this.finishEditing(),this.textEdit=t,this.bindTextConfigUi(this.textEdit),y.setContent(e.HINT_ELEMENT_ID,e.HINT_EDIT_TEXT);var i=this;this._mouseListener=new(function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.down=!1,t.drag=!1,t.dragX=0,t.dragY=0,t}return H(n,e),n.prototype.onmousedown=function(e){if(0==e.button){this.down=!0,this.drag=!1;var n=i.camera.screenXyToCanvas(e.offsetX,e.offsetY);if(t.pick(n.x,n.y,i.camera.screenSizeToCanvas(5))&&e.altKey){if(e.ctrlKey){var o=new j(t.clone(0,0));i.layerView.addText(o)}return this.drag=!0,this.dragX=n.x-t.x,this.dragY=n.y-t.y,e.altKey}}return!1},n.prototype.onmouseup=function(t){var e=!this.drag;return this.drag=!1,0==t.button&&(this.down=!1,!e)},n.prototype.onmousemove=function(t){if(this.down&&this.drag){var e=i.camera.screenXyToCanvas(t.offsetX,t.offsetY);return i.textEdit.setPosition(e.x-this.dragX,e.y-this.dragY),i.canvas.requestRender(),!0}return!1},n}(w)),this._keyboardListener=y.createTextKeyboardListener(i.canvas,i.camera,i.textEdit,(function(){n.deleteEditing(),_.deselect(E.TEXT_EDIT)})),this.canvas.requestRender()},e.prototype.finishEditing=function(){y.setVisibility("panelTextSelected",!1),this.textEdit&&(0==this.textEdit.text.length&&this.layerView.deleteText(this.textEdit),this.textEdit=null,this.canvas.requestRender()),this._mouseListener=null,this._keyboardListener=null},e.prototype.render=function(t){if(this.textEdit){t.setColor(this.textEdit.colorString);var e=this.textEdit.validateCanvasAABB(this.camera,t),n=this.camera.canvasToScreen(e.x1,e.y1),i=this.camera.canvasToScreen(e.x2,e.y2);t.drawRect(n.x-5,n.y-5,i.x+5,i.y+5,!1,!0,2)}},e.prototype.deleteEditing=function(){this.textEdit&&(this.layerView.deleteText(this.textEdit),this.finishEditing())},e.prototype.bindTextConfigUi=function(t){var e=this;y.setVisibility("panelTextSelected",!0),y.bindButtonOnClick("textButtonCopy",(function(){var n=e.canvas.getCamera().screenSizeToCanvas(10),i=new j(t.clone(n,n));e.finishEditing(),e.layerView.addText(i),e.startEditingText(i),e.canvas.requestRender()})),y.bindValue("textTextContent",t.text,(function(n){t.text=n,e.canvas.requestRender()})),y.bindNumber("textTextSizeOnScreen",t.onScreen,(function(n){t.onScreen=n,e.canvas.requestRender()})),y.bindNumber("textTextSizeOnCanvas",t.onCanvas,(function(n){t.onCanvas=n,e.canvas.requestRender()})),y.bindNumber("textTextSizeOfScreen",1e3*t.ofScreen,(function(n){t.ofScreen=.001*n,e.canvas.requestRender()})),y.bindColor("textContainerColor","textContainerAlpha",t.color,t.alpha,(function(n,i){t.setColorAlpha(n,i),e.canvas.requestRender()}))},e.HINT_ELEMENT_ID="hint",e.HINT_EDIT_TEXT="1. hold alt to drag<br>2. hold ctrl+alt to copy and drag<br>3. WSAD ↑↓←→ to move, hold shift to speed up<br>4. press del to delete<br>",e}(g),Z=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),F=function(t){function e(e){var n=t.call(this,E.TEXT_VIEW,e)||this;return n.texts=[],n}return Z(e,t),e.prototype.loadData=function(t){if(this.texts=[],t.texts)for(var e=0,n=t.texts;e<n.length;e++){var i=n[e];this.texts.push(new j(i))}var o=this;this._mouseListener=new(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.moved=!1,e}return Z(e,t),e.prototype.onmousedown=function(t){return this.moved=!1,!1},e.prototype.onmouseup=function(t){if(0!=t.button||this.moved)return!1;for(var e=o.camera.screenXyToCanvas(t.offsetX,t.offsetY),n=e.x,i=e.y,r=null,s=0,a=o.texts;s<a.length;s++){var l=a[s];l.pick(n,i,o.camera.screenSizeToCanvas(5))&&(r=l)}return r?(_.select(E.TEXT_EDIT,r),!0):(_.deselect(E.TEXT_CREATE),_.deselect(E.TEXT_EDIT),!1)},e.prototype.onmousemove=function(t){return 1&t.buttons&&0!=t.movementX&&0!=t.movementY&&(this.moved=!0),!1},e}(w))},e.prototype.addText=function(t){this.texts.push(t),this.canvas.requestRender()},e.prototype.deleteText=function(t){var e=this.texts.indexOf(t);return-1!==e&&(this.texts.splice(e,1),!0)},e.prototype.saveData=function(t){t.texts=[];for(var e=0,n=this.texts;e<n.length;e++){var i=n[e];t.texts.push(i.pack())}},e.prototype.render=function(e){t.prototype.render.call(this,e);for(var n=0,i=this.texts;n<i.length;n++){i[n].render(this.canvas,e,this.camera)}},e.prototype.unload=function(){t.prototype.unload.call(this)},e}(g),U=function(){function t(){}return t.getComments=function(t,e,n){m.get("https://api.github.com/repos/"+t+"/issues/"+e+"/comments",(function(t){try{var e=JSON.parse(t);n(e)}catch(t){}}))},t.getIssueLink=function(t,e){return"https://github.com/"+t+"/issues/"+e},t.getCommentLink=function(t,e,n){return"https://github.com/"+t+"/issues/"+e+"#issuecomment-"+n},t}(),G=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),J=function(t){function e(e){var n=t.call(this,E.POLYLINE_CREATE,e)||this;return n.polylineNew=null,_.register(E.POLYLINE_CREATE,(function(){n.startCreatingPolyline()}),(function(){n.finishEditing()})),n}return G(e,t),e.prototype.loadMap=function(t){this.map=t},e.prototype.loadData=function(t){this.layerView=this.canvas.findLayer(E.POLYLINE_VIEW),this.polylineNew=null,this.finishEditing(),y.setVisibility("panelPolylineSelected",!1)},e.prototype.createPolylineAndEdit=function(){this.polylineNew=new X(new N([],!0,new S(2),!0,"white","25",!0,"white","75")),_.select(E.POLYLINE_CREATE,this.polylineNew)},e.prototype.startCreatingPolyline=function(){var t=this,n=this;return this.bindPolylineConfigUi(this.polylineNew),y.setContent(e.HINT_ELEMENT_ID,e.HINT_NEW_POLYLINE),this._mouseListener=new(function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.down=!1,e.moved=!1,e}return G(i,t),i.prototype.preview=function(t,i){if(n.polylineNew.editor.setPoint(-1,t.x,t.y),i){var o=n.camera.screenSizeToCanvas(e.MAG_RADIUS),r=n.polylineNew.calculator.alignPoint(-1,o);n.polylineNew.editor.setPoint(-1,r.x,r.y)}},i.prototype.onmousedown=function(t){if(0==t.button&&!this.down){this.down=!0;var e=n.camera.screenXyToCanvas(t.offsetX,t.offsetY);return n.polylineNew.editor.addPoint(e.x,e.y),n.canvas.requestRender(),!0}return 2==t.button&&(this.moved=!1),!1},i.prototype.onmouseup=function(t){if(0==t.button){this.down=!1;var e=n.camera.screenXyToCanvas(t.offsetX,t.offsetY);return this.preview(e,t.ctrlKey),n.canvas.requestRender(),!0}if(2==t.button){if(!this.moved){var i=n.polylineNew;n.finishEditing(),n.layerView.containPolyline(i)&&_.select(E.POLYLINE_EDIT,i)}return this.moved=!1,!0}return!1},i.prototype.onmousemove=function(t){if(this.down){var e=n.camera.screenXyToCanvas(t.offsetX,t.offsetY);return this.preview(e,t.ctrlKey),n.canvas.requestRender(),!0}return 2&t.buttons&&(this.moved=!0),!1},i}(w)),this._keyboardListener=y.createPolylineKeyboardListener(n.canvas,n.camera,n.polylineNew,(function(){t.deleteCreating(),_.deselect(E.POLYLINE_CREATE)})),this.polylineNew},e.prototype.deleteCreating=function(){this.polylineNew=null,this.finishEditing(),this.canvas.requestRender()},e.prototype.finishEditing=function(){y.setVisibility("panelPolylineSelected",!1),this.polylineNew&&(this.polylineNew.editor.pointCount()>2&&this.layerView.addPolyline(this.polylineNew),this.polylineNew=null,this.canvas.requestRender()),this._mouseListener=null,this._keyboardListener=null},e.prototype.render=function(t){if(this.polylineNew){this.polylineNew.render(this.canvas,t,this.camera);var e=this.polylineNew.editor.pointCount();if(e>0){var n=this.polylineNew.editor.getPoint(0);this.drawPointCircle(n.x,n.y,t)}if(e>1){n=this.polylineNew.editor.getPoint(-1);this.drawPointCircle(n.x,n.y,t)}}},e.prototype.drawPointCircle=function(t,e,n){var i=this.camera.canvasToScreen(t,e);n.setColor("rgba(255,255,255,1)"),n.drawCircle(i.x,i.y,5,!1,!0,1),n.setColor("rgba(0,0,0,0.5)"),n.drawCircle(i.x,i.y,4,!0,!1)},e.prototype.bindPolylineConfigUi=function(t){var e=this;y.setVisibility("panelPolylineSelected",!0),y.bindButtonOnClick("polylineButtonCopy",(function(){var n=e.canvas.getCamera().screenSizeToCanvas(20),i=new X(t.clone(n,n));e.finishEditing(),e.layerView.addPolyline(i),_.select(E.POLYLINE_CREATE,i),e.canvas.requestRender()})),y.bindButtonOnClick("polylineButtonArea",(function(){if(y.setContent("polylineTextArea",""),t.style.fill){var n=e.map.widthMillimeter,i=e.map.heightMillimeter,o="mm^2";e.map.widthMillimeter>0&&e.map.heightMillimeter>0||(n=e.map.width,i=e.map.height,o="pixels");var r=t.calculator.area()/e.map.width/e.map.height*n*i;r=Math.round(100*r)/100,y.setContent("polylineTextArea",r+o)}else{n=e.map.widthMillimeter,i=e.map.heightMillimeter,o="mm";e.map.widthMillimeter>0&&e.map.heightMillimeter>0||(n=e.map.width,i=e.map.height,o="pixels");var s=t.calculator.length()*Math.sqrt(n*i/e.map.width/e.map.height);s=Math.round(100*s)/100,y.setContent("polylineTextArea",s+o)}})),y.setContent("polylineTextArea",""),y.bindButtonOnClick("polylineButtonRotateCCW",(function(){t.editor.rotateCCW(),e.canvas.requestRender()})),y.bindButtonOnClick("polylineButtonRotateCW",(function(){t.editor.rotateCW(),e.canvas.requestRender()})),y.bindButtonOnClick("polylineButtonFlipX",(function(){t.editor.flipX(),e.canvas.requestRender()})),y.bindButtonOnClick("polylineButtonFlipY",(function(){t.editor.flipY(),e.canvas.requestRender()})),y.bindCheckbox("polylineCheckboxFill",t.style.fill,(function(n){t.style.fill=n,e.canvas.requestRender()})),y.bindCheckbox("polylineCheckboxStroke",t.style.stroke,(function(n){t.style.stroke=n,e.canvas.requestRender()})),y.bindCheckbox("polylineCheckboxClosed",t.style.closed,(function(n){t.style.closed=n,e.canvas.requestRender()})),y.bindNumber("polylineTextSizeOnScreen",t.style.onScreen,(function(n){t.style.onScreen=n,e.canvas.requestRender()})),y.bindNumber("polylineTextSizeOnCanvas",t.style.onCanvas,(function(n){t.style.onCanvas=n,e.canvas.requestRender()})),y.bindNumber("polylineTextSizeOfScreen",1e3*t.style.ofScreen,(function(n){t.style.ofScreen=.001*n,e.canvas.requestRender()})),y.bindColor("polylineContainerStrokeColor","polylineContainerStrokeAlpha",t.style.strokeColor,t.style.strokeAlpha,(function(n,i){t.style.setStrokeColor(n,i),e.canvas.requestRender()})),y.bindColor("polylineContainerFillColor","polylineContainerFillAlpha",t.style.fillColor,t.style.fillAlpha,(function(n,i){t.style.setFillColor(n,i),e.canvas.requestRender()}))},e.HINT_ELEMENT_ID="hint",e.HINT_NEW_POLYLINE="1. left click to create point<br>2. hold left button to preview point<br>3. right click to finish creating<br>4. hold ctrl to help with horizontal/vertical line<br>5. WSAD ↑↓←→ to move, hold shift to speed up<br>6. press del to delete<br>",e.MAG_RADIUS=10,e}(g),Q=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),$=function(t){function e(e){var n=t.call(this,E.TEXT_CREATE,e)||this;return _.register(E.TEXT_CREATE,(function(t){n.startCreatingText()}),(function(){n.finishCreating()})),n}return Q(e,t),e.prototype.loadData=function(t){this.layerView=this.canvas.findLayer(E.TEXT_VIEW),this.finishCreating(),y.setVisibility("panelTextSelected",!1)},e.prototype.createTextAndEdit=function(){this.textNew=new j(new V("text","white","100",new S(5,50),0,0)),_.select(E.TEXT_CREATE,this.textNew)},e.prototype.startCreatingText=function(){var t=this;this.finishCreating();var n=this;this.bindTextConfigUi(this.textNew),y.setContent(e.HINT_ELEMENT_ID,e.HINT_NEW_TEXT),this._mouseListener=new(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.down=!1,e}return Q(e,t),e.prototype.onmousedown=function(t){return 0==t.button&&(this.down=!0,!0)},e.prototype.onmouseup=function(t){if(0==t.button){this.down=!1;var e=n.camera.screenXyToCanvas(t.offsetX,t.offsetY);return n.textNew.setPosition(e.x,e.y),n.layerView.addText(n.textNew),_.select(E.TEXT_EDIT,n.textNew),n.canvas.requestRender(),!0}return!1},e.prototype.onmousemove=function(t){return 1&t.buttons&&this.down},e}(w)),this._keyboardListener=y.createTextKeyboardListener(n.canvas,n.camera,n.textNew,(function(){t.deleteCreating(),_.deselect(E.TEXT_CREATE)}))},e.prototype.finishCreating=function(){y.setVisibility("panelTextSelected",!1),this._mouseListener=null,this._keyboardListener=null},e.prototype.render=function(t){},e.prototype.deleteCreating=function(){this.textNew&&(this.layerView.deleteText(this.textNew),this.textNew=null,this.finishCreating())},e.prototype.bindTextConfigUi=function(t){var e=this;y.setVisibility("panelTextSelected",!0),y.bindButtonOnClick("textButtonCopy",(function(){})),y.bindValue("textTextContent",t.text,(function(n){t.text=n,e.canvas.requestRender()})),y.bindNumber("textTextSizeOnScreen",t.onScreen,(function(n){t.onScreen=n,e.canvas.requestRender()})),y.bindNumber("textTextSizeOnCanvas",t.onCanvas,(function(n){t.onCanvas=n,e.canvas.requestRender()})),y.bindNumber("textTextSizeOfScreen",1e3*t.ofScreen,(function(n){t.ofScreen=.001*n,e.canvas.requestRender()})),y.bindColor("textContainerColor","textContainerAlpha",t.color,t.alpha,(function(n,i){t.setColorAlpha(n,i),e.canvas.requestRender()}))},e.HINT_ELEMENT_ID="hint",e.HINT_NEW_TEXT="1. left click to create text<br>2. WSAD ↑↓←→ to move, hold shift to speed up<br>3. press del to delete<br>",e}(g);y.isMobile()?document.getElementById("panel").style.display="none":document.getElementById("panel").style.display="flex";var tt=new v(document.getElementById("container"),"canvas2d");tt.init();var et=new k(tt),nt=new q(tt),it=new J(tt),ot=new z(tt),rt=new F(tt),st=new $(tt),at=new K(tt);tt.addLayer(et),tt.addLayer(nt),tt.addLayer(ot),tt.addLayer(it),tt.addLayer(rt),tt.addLayer(at),tt.addLayer(st),y.bindButtonOnClick("buttonNewPolyline",(function(){at.finishEditing(),it.createPolylineAndEdit()})),y.bindButtonOnClick("polylineButtonDelete",(function(){ot.deleteEditing(),it.deleteCreating(),at.finishEditing(),ot.finishEditing()})),y.bindButtonOnClick("buttonNewText",(function(){ot.finishEditing(),st.createTextAndEdit()})),y.bindButtonOnClick("textButtonDelete",(function(){ot.finishEditing(),st.deleteCreating(),st.finishCreating(),at.deleteEditing(),at.finishEditing()})),(new(function(){function t(){this.currentChip=null,this.issueLink="",this.currentCommentId=0,this.dummyData=null}return t.prototype.start=function(){var t=this;m.get("https://misdake.github.io/ChipAnnotationData/list.json",(function(e){var n=JSON.parse(e),i={},o=[],r=[],s={},a=[];if(n&&n.length)for(var l=0,c=n;l<c.length;l++){var u=(v=c[l]).vendor+" "+v.type+" "+v.family+" "+v.name;a.push(u),s[u]=v,i[v.name]=v}a.sort();for(var h="",p="",f=0,d=a;f<d.length;f++){var v,m=(v=s[d[f]]).vendor+" "+v.type,g=""+v.family;h!==m&&m&&m.length&&(o.push(m),r.push(null)),p!==g&&g&&g.length&&(o.push("    "+g),r.push(null)),o.push("        "+v.name),r.push(v),h=m,p=g}var x=window.location.href,b=new URL(x),C=b.searchParams.get("map")||"Fiji",w=b.searchParams.get("commentId")||"0";t.currentCommentId=parseInt(w),y.bindSelect("mapSelect",o,"        "+C,(function(e,n){t.currentCommentId=0;var i=r[e];i&&(t.loadMap(i),t.replaceUrl())})),t.loadMap(i[C])}))},t.prototype.loadMap=function(t){var e=this;this.currentChip=t,m.get(t.url+"/content.json",(function(t){var n=JSON.parse(t);tt.loadMap(n),tt.requestRender(),e.issueLink=U.getIssueLink(n.githubRepo,n.githubIssueId),y.bindButtonOnClick("buttonSave",(function(){at.finishEditing(),ot.finishEditing();var t=tt.save();t.title=document.getElementById("dataTitle").value,null!=t.title&&""!=t.title||(t.title="untitled");var n=JSON.stringify(t);navigator.clipboard.writeText(n).then((function(){e.issueLink&&window.open(e.issueLink,"_blank")}))})),y.bindValue("dataTitle","",(function(t){})),y.bindSelect("dataSelect",[],null,(function(t){})),e.dummyData=new l,e.dummyData.title="",tt.loadData(e.dummyData),e.loadGithubComment(n,e.currentCommentId),y.bindButtonOnClick("buttonRefreshData",(function(){e.loadGithubComment(n,e.currentCommentId)}))}))},t.prototype.loadGithubComment=function(t,e){var n=this;t.githubRepo&&t.githubIssueId&&U.getComments(t.githubRepo,t.githubIssueId,(function(i){var o=[],r=[],s=[];o.push(null),r.push(n.dummyData),s.push("dummy");for(var a=0,l=n.dummyData,c=0,u=0,h=i;u<h.length;u++){var p=h[u];try{var f=JSON.parse(p.body);null!=f.polylines&&null!=f.texts&&(null!=f.title&&""!=f.title||(f.title="untitled"),o.push(p),r.push(f),s.push(f.title+" @"+p.user.login),e==p.id&&(a=o.length-1,l=f,c=p.id))}catch(t){}}s[0]="(annotation count: "+(s.length-1)+")",y.bindSelect("dataSelect",s,s[a],(function(e){var i=o[e],s=r[e];n.loadData(t,s,i?i.id:0)})),n.loadData(t,l,c)}))},t.prototype.loadData=function(t,e,n){y.bindValue("dataTitle",e.title,(function(t){})),this.currentCommentId=n,this.issueLink=n>0?U.getCommentLink(t.githubRepo,t.githubIssueId,n):U.getIssueLink(t.githubRepo,t.githubIssueId),tt.loadData(e),this.replaceUrl(),tt.requestRender()},t.prototype.replaceUrl=function(){var t=location.pathname+"?map="+this.currentChip.name;this.currentCommentId>0&&(t+="&commentId="+this.currentCommentId),history.replaceState(null,"",t)},t}())).start()}]);